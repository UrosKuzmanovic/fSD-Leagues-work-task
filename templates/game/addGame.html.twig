{% extends 'base.html.twig' %}

{% block title %}Add match{% endblock %}

{% block body %}
    <p><a href="{{ path('home') }}">BACK TO HOME PAGE</a></p>
    <p><a href="{{ path('game_list') }}">LIST OF GAMES</a></p>

    <label for="home">Home team</label>
    <select id="home">
        {% for club in clubs %}
            <option value="{{ club.getClubID() }}">{{ club.getName() }}</option>
        {% endfor %}
    </select><br>

    <label for="away">Away team</label>
    <select id="away">
        {% for club in clubs %}
            <option value="{{ club.getClubID() }}">{{ club.getName() }}</option>
        {% endfor %}
    </select><br>

    <label>Result</label>
    <input type="number" placeholder="Home" id="homeGoals"> -
    <input type="number" placeholder="Away" id="awayGoals"><br>

    <label for="competition">Competition</label>
    <select id="competition">
        {% for competition in competitions %}
            <option value="{{ competition.getCompetitionID() }}">{{ competition.getCompetitionName() }}</option>
        {% endfor %}
    </select><br>

    <label for="date">Date</label>
    <input type="date" id="date"><br><br>

    <button onclick="addGame()">Add game</button>

    <p id="error"></p>
{% endblock %}

{% block myJavascripts %}
    <script>
        function addGame() {
            let home = $('#home').val();
            let away = $('#away').val();
            let homeGoals = $('#homeGoals').val();
            let awayGoals = $('#awayGoals').val();
            let competition = $('#competition').val();
            let date = $('#date').val();

            if (home === "" || away === "" || homeGoals === "" || awayGoals === "" || competition === "" || date === "") {
                $('#error').html("Please enter all of the fields.");
            } else if (home === away) {
                $('#error').html("Home and away club can't be same.");
            } else {
                $.post("{{ path('post_game') }}", {
                        data: {
                            home: home,
                            away: away,
                            homeGoals: homeGoals,
                            awayGoals: awayGoals,
                            competition: competition,
                            date: date
                        }
                    }, function (data) {
                        let obj = JSON.parse(data);
                        if (obj['gameID']) {
                            alert("New game was successfully added!");
                            window.location.replace("{{ path('game_list') }}")
                        } else {
                            alert("There was an error while adding new game.");
                        }
                    }
                );
            }
        }
    </script>
{% endblock %}
